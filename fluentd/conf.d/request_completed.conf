<filter app.**>
  @type grep
  <regexp>
    key messages
    pattern /\ACompleted \d{3} .* in \d+ms\b/
  </regexp>
</filter>

<filter app.**>
  @type record_transformer
  remove_keys severity
</filter>

<match app.**>
  @type copy
  copy_mode shallow
  <store>
    @type rewrite_tag_filter
    <rule>
      key messages
      pattern //
      tag duration.Views.${tag}
    </rule>
  </store>
#  <store>
#    @type rewrite_tag_filter
#    key messages
#    pattern //
#    tag duration.ActiveRecord.${tag}
#  </store>
</match>

<filter duration.**>
  @type parser
  key_name messages
  reserve_time true
  reserve_data true
  <parse>
    @type regexp
    expression /\b(?<category>${tag_parts[1]}): (?<duration>\d+\.\d+)ms\b/
    types duration:float
  </parse>
</filter>

<match duration.**>
  @type rewrite_tag_filter
  <rule>
    key messages
    pattern //
    tag finish.durations
  </rule>
</match>
